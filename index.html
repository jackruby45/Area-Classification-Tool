<!DOCTYPE html>
<html>
  <head>
    <title>Ventilation Calculator for Electrical Area Classification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
          "marked": "https://esm.sh/marked@^12.0.0",
          "jspdf": "https://esm.sh/jspdf@^2.5.1",
          "jspdf-autotable": "https://esm.sh/jspdf-autotable@^3.8.2"
        }
      }
    </script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <main>
      <header>
        <h1>Ventilation Calculator</h1>
        <p>
          For Electrical Area Classification based on AGA XL1001 &amp; API RP 500
          guidelines. By Tim Bickford Rev 1
        </p>
      </header>

      <nav class="tabs">
        <button id="calculator-tab" class="tab-btn active-tab" aria-selected="true">Calculator</button>
        <button id="results-summary-tab" class="tab-btn hidden" aria-selected="false">Results</button>
        <button id="admin-tab" class="tab-btn" aria-selected="false">Admin</button>
        <button id="report-tab" class="tab-btn hidden" aria-selected="false">Report</button>
      </nav>

      <div id="calculator-content">
        <form id="calc-form" aria-labelledby="form-title">
          
          <fieldset class="form-section">
            <legend>Project Information</legend>
            <div class="input-grid">
              <div class="input-group full-width-item">
                  <label for="project-name">Project Name</label>
                  <input type="text" id="project-name" name="project-name" placeholder="e.g., Compressor Station Upgrade" required value="Juniper Ridge District regulating station">
              </div>
              <div class="input-group">
                  <label for="location">Location</label>
                  <input type="text" id="location" name="location" placeholder="e.g., Midland, TX" required value="Montgomery Texas">
              </div>
              <div class="input-group">
                  <label for="company">Company</label>
                  <input type="text" id="company" name="company" placeholder="e.g., ACME Energy" required value="unitil">
              </div>
              <div class="input-group">
                  <label for="date">Date</label>
                  <input type="date" id="date" name="date" required>
              </div>
              <div class="input-group">
                  <label for="performed-by">Performed By</label>
                  <input type="text" id="performed-by" name="performed-by" placeholder="e.g., J. Doe" required value="Tim BickfordðŸŽ¸">
              </div>
            </div>
          </fieldset>
          
          <fieldset class="form-section">
            <legend id="form-title">Building &amp; Environmental Data</legend>

            <div class="input-grid">
              <div class="input-group full-width-item">
                <label for="calculation-goal">Calculation Goal</label>
                <select id="calculation-goal" name="calculation-goal" required>
                  <option value="reclassify-d1-to-d2">
                    Reclassify from Class 1 Div 1 to Div 2
                  </option>
                  <option value="maintain-d2" selected>
                    Maintain an existing Class 1 Div 2 classification
                  </option>
                </select>
              </div>
              <div class="input-group">
                <label for="length">Building Length (ft)</label>
                <input
                  type="number"
                  id="length"
                  name="length"
                  required
                  min="0"
                  step="any"
                  value="20"
                />
              </div>
              <div class="input-group">
                <label for="width">Building Width (ft)</label>
                <input
                  type="number"
                  id="width"
                  name="width"
                  required
                  min="0"
                  step="any"
                  value="9.4167"
                />
              </div>
              <div class="input-group">
                <label for="height" title="The vertical distance between the center of the lower and upper ventilation openings.">Building Height (ft)</label>
                <input
                  type="number"
                  id="height"
                  name="height"
                  required
                  min="0"
                  step="any"
                  value="7.67"
                />
              </div>
              <div class="input-group">
                <label for="inside-temp">
                  Inside Temperature (Â°F)
                  <span class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-text">Worst-case for ventilation is the smallest temperature difference (approaching 0Â°F), as this minimizes the 'Stack Effect' driving force.</span>
                  </span>
                </label>
                <input
                  type="number"
                  id="inside-temp"
                  name="inside-temp"
                  required
                  step="any"
                  value="68"
                />
              </div>
              <div class="input-group">
                <label for="outside-temp">
                  Outside Temperature (Â°F)
                   <span class="tooltip-container">
                    <span class="tooltip-icon">?</span>
                    <span class="tooltip-text">Worst-case for ventilation is the smallest temperature difference (approaching 0Â°F), as this minimizes the 'Stack Effect' driving force.</span>
                  </span>
                </label>
                <input
                  type="number"
                  id="outside-temp"
                  name="outside-temp"
                  required
                  step="any"
                  value="50"
                />
              </div>
              <div class="input-group">
                <label for="wind-velocity" title="A conservative, year-round average wind speed for the location.">Average Wind Velocity (mph)</label>
                <input
                  type="number"
                  id="wind-velocity"
                  name="wind-velocity"
                  required
                  min="0"
                  step="any"
                  value="7"
                />
              </div>

              <div class="input-group">
                <label for="building-orientation" title="The orientation of the building's vents relative to the prevailing wind direction.">Building Orientation</label>
                <select id="building-orientation" name="building-orientation">
                  <option value="1.0" selected>Perpendicular (0Â°) - Most Effective</option>
                  <option value="0.7">Angled (45Â°) - Moderately Effective</option>
                  <option value="0.3">Parallel (90Â°) - Least Effective</option>
                </select>
              </div>
              <div class="input-group">
                <label for="surrounding-terrain" title="The local environment affects wind speed at the building's height.">Surrounding Terrain</label>
                <select id="surrounding-terrain" name="surrounding-terrain">
                  <option value="1.0" selected>Open Terrain (Flat, open country)</option>
                  <option value="0.85">Suburban / Wooded (Residential areas)</option>
                  <option value="0.67">Urban / Industrial (City centers)</option>
                </select>
              </div>
              <div class="input-group">
                <label for="vent-opening-type" title="The physical shape of the vent opening affects airflow efficiency (Discharge Coefficient K).">Vent Opening Type (K)</label>
                <select id="vent-opening-type" name="vent-opening-type">
                  <option value="0.65" selected>Sharp-Edged Orifice (Typical, K=0.65)</option>
                  <option value="0.98">Well-Rounded Inlet (Efficient, K=0.98)</option>
                  <option value="0.50">Re-entrant (Inefficient, K=0.50)</option>
                </select>
              </div>

               <div class="input-group">
                <label for="inlet-obstruction" title="Accounts for airflow reduction from items like screens or louvers on the inlet vent.">Inlet Vent Obstruction</label>
                <select id="inlet-obstruction" name="inlet-obstruction">
                  <option value="1.0">None (Unobstructed)</option>
                  <option value="0.92">Bird Screen (92% Free Area)</option>
                  <option value="0.85">Insect Screen (85% Free Area)</option>
                  <option value="0.75">Weather Hood (75% Free Area)</option>
                  <option value="0.55" selected>Standard Louver (55% Free Area)</option>
                  <option value="0.35">Acoustic Louver (35% Free Area)</option>
                </select>
              </div>
              <div class="input-group">
                <label for="outlet-obstruction" title="Accounts for airflow reduction from items like screens or louvers on the outlet vent.">Outlet Vent Obstruction</label>
                <select id="outlet-obstruction" name="outlet-obstruction">
                  <option value="1.0">None (Unobstructed)</option>
                  <option value="0.92">Bird Screen (92% Free Area)</option>
                  <option value="0.85">Insect Screen (85% Free Area)</option>
                  <option value="0.75">Weather Hood (75% Free Area)</option>
                  <option value="0.55" selected>Standard Louver (55% Free Area)</option>
                  <option value="0.35">Acoustic Louver (35% Free Area)</option>
                </select>
              </div>

              <div class="input-group full-width-item">
                <label for="calculation-method">Calculation Method</label>
                <select id="calculation-method" name="calculation-method" required>
                  <option value="area-method" selected>
                    Area Method (AGA XL1001)
                  </option>
                  <option value="fugitive-emission-method">
                    Fugitive Emission Method (API RP 500)
                  </option>
                </select>
              </div>
            </div>

            <div id="fugitive-emission-inputs-wrapper" class="hidden">
              <h3 class="subsection-title">Fugitive Emission Parameters</h3>
              <div class="input-grid">
                <div class="input-group">
                  <label for="leak-rate">Gas Leak Rate (Q_leak) (CFM)</label>
                  <input
                    type="number"
                    id="leak-rate"
                    name="leak-rate"
                    min="0"
                    step="any"
                  />
                </div>
                <div class="input-group">
                  <label for="lfl" title="The Lower Flammable Limit of the potential gas leak.">Gas LFL (%)</label>
                  <input
                    type="number"
                    id="lfl"
                    name="lfl"
                    placeholder="e.g., 5"
                    min="0.1"
                    step="any"
                    value="5"
                  />
                </div>
                <div class="input-group">
                  <label for="safety-factor" title="Safety factor (often 0.25 for 25% LFL) to ensure dilution well below the flammable limit.">Safety Factor (C)</label>
                  <input
                    type="number"
                    id="safety-factor"
                    name="safety-factor"
                    placeholder="e.g., 0.25"
                    min="0.01"
                    max="1"
                    step="any"
                    value="0.25"
                  />
                </div>
              </div>
            </div>
          </fieldset>

          <div class="form-actions">
            <button type="button" id="load-calc-btn" class="secondary-btn">Load Calculation from File</button>
            <input type="file" id="load-file-input" class="hidden" accept=".json,application/json">
            <button type="submit" id="calculate-btn">
              Calculate Required Ventilation
            </button>
          </div>
        </form>

        <section id="results-container" aria-live="polite">
          <div id="results-placeholder">
            Enter your building's data above to calculate the required vent area.
          </div>
          <div id="loading-indicator" class="hidden">
            <div class="spinner"></div>
            <p>Consulting with engineering standards and calculating...</p>
          </div>
          <div id="error-message" class="hidden"></div>
          <div id="results-content">
             <!-- Results will be dynamically inserted here -->
          </div>
        </section>

      </div>
      
      <div id="results-summary-content" class="hidden content-panel">
        <!-- Detailed results report will be dynamically inserted here -->
      </div>

      <div id="admin-login-content" class="hidden">
        <form id="admin-login-form" class="content-panel">
            <h2>Admin Login</h2>
            <div class="input-group">
                <label for="admin-password">Password</label>
                <input type="password" id="admin-password" name="admin-password" required>
            </div>
            <div id="login-error-message" class="hidden"></div>
            <button type="submit" id="login-btn">Login</button>
        </form>
      </div>

      <div id="admin-panel-content" class="hidden">
         <section class="content-panel">
            <h2>Admin Panel</h2>
            <p>Admin features will be added here.</p>
            <div class="admin-actions">
                <button id="logout-btn" class="secondary-btn">Logout</button>
            </div>
        </section>
      </div>

      <div id="report-content" class="hidden">
        <section class="content-panel">
           <h2>Report Generation</h2>
           <p>You can download a PDF report or copy the LaTeX code for use in an external editor like Overleaf.</p>
           <div class="report-actions">
                <button id="download-pdf-btn">Download PDF</button>
                <button id="copy-latex-btn">Copy LaTeX Code</button>
           </div>
           <pre><code id="latex-code-output">No report has been generated yet.</code></pre>
       </section>
     </div>

    </main>
    <script type="module" src="index.tsx"></script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>